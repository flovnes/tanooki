<% user_id = user_id || grouped_chapters_desc(fiction).first.first %>

<div class="overflow-y-auto max-h-[55rem]" id="chapters-list">
  <% if @reading_progress.present? && @reading_progress.chapter != ordered_chapters(@fiction).last %>
    <% if duplicate_chapters(@fiction).any? %>
      <%= render 'chapter_progress_list_multiple_authors', before_next_chapter: @before_next_chapter, after_next_chapter: @after_next_chapter, fiction: @fiction, selected_user_id: user_id %>
    <% else %>
      <%= render 'chapter_progress_list_one_author', before_next_chapter: @before_next_chapter, after_next_chapter: @after_next_chapter %>
    <% end %>
  <% else %>
    <div class="lg:max-w-3xl pb-5 px-5 mx-auto mt-4 mb-2 space-y-5 border border-gray-100 rounded-lg bg-gray-50">
      <ul class="divide-y divide-gray-200">
        <% if duplicate_chapters(@fiction).any? %>
          <%= render 'alternative_tabs', fiction: @fiction, selected_user_id: user_id %>
          <% ordered_chapters_desc(@fiction).where(user_id: user_id).each_with_index do |chapter, index| %>
            <%= render 'chapter_item', chapter: chapter, index: index, color: :black %>
          <% end %>
        <% else %>
          <% ordered_chapters_desc(@fiction).each_with_index do |chapter, index| %>
            <%= render 'chapter_item', chapter: chapter, index: index, color: :black %>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
